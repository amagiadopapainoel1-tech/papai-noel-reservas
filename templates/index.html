<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reserva Papai Noel</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

    <!-- üî¥ MOLDURA DE FUNDO (AGORA INCLU√çDA!) -->
    <div class="background-frame"></div>

    <div class="phone-frame">
        <div class="form-wrapper">
            <div class="form-container">

                {% if mensagem %}
                <div class="msg">{{ mensagem }}</div>
                {% endif %}

                <form action="/enviar" method="POST">

                    <!-- DATA -->
                    <label class="label">Data</label>
                    <select name="data" id="data" class="input" required>
                        <option value="">Selecione...</option>
                        <option value="2024-12-24">24 de Dezembro</option>
                        <option value="2024-12-25">25 de Dezembro</option>
                    </select>

                    <!-- HOR√ÅRIO -->
                    <label class="label">Hor√°rio</label>
                    <select name="horario" id="horario" class="input" required>
                        <option value="">Selecione a data...</option>
                    </select>

                    <!-- RESPONS√ÅVEL -->
                    <label class="label">Respons√°vel</label>
                    <input type="text" name="responsavel" class="input" required>

                    <!-- N¬∫ CRIAN√áAS -->
                    <label class="label">N¬∫ de crian√ßas</label>
                    <input type="number" name="numero_criancas" id="numero_criancas" class="input" required>

                    <!-- VALOR TOTAL (CALCULADO AUTOMATICAMENTE) -->
                    <label class="label">Valor Total</label>
                    <input type="text" name="valor_total" id="valor_total" class="input" readonly>

                    <!-- E-MAIL -->
                    <label class="label">E-mail</label>
                    <input type="email" name="email" class="input" required>

                    <!-- TELEFONE -->
                    <label class="label">Telefone</label>
                    <input type="text" name="telefone" class="input">

                    <!-- STATUS -->
                    <label class="label">Status do Pagamento</label>
                    <select name="status_pagamento" class="input">
                        <option value="Pendente">Pendente</option>
                        <option value="Pago">Pago</option>
                    </select>

                    <!-- OBSERVA√á√ïES -->
                    <label class="label">Observa√ß√µes</label>
                    <textarea name="observacoes" class="input"></textarea>

                    <!-- ENDERE√áO -->
                    <label class="label">Endere√ßo</label>
                    <input type="text" name="endereco" class="input">

                    <!-- BAIRRO -->
                    <label class="label">Bairro</label>
                    <input type="text" name="bairro" class="input">

                    <!-- CIDADE -->
                    <label class="label">Cidade</label>
                    <input type="text" name="cidade" class="input">

                    <button type="submit">Enviar Reserva</button>
                </form>
            </div>
        </div>
    </div>


<script>
/* --- Atualiza hor√°rios conforme a data selecionada --- */
document.getElementById("data").addEventListener("change", function () {
    const data = this.value;
    const select = document.getElementById("horario");
    select.innerHTML = "<option>Carregando hor√°rios...</option>";

    fetch("/horarios_indisponiveis", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: "data=" + data
    })
    .then(res => res.json())
    .then(json => {
        const ocupados = json.ocupados;
        const horarios = json.horarios_disponiveis;
        select.innerHTML = "";
        horarios.forEach(h => {
            const opt = document.createElement("option");
            opt.value = h;
            opt.textContent = ocupados.includes(h)
                ? h + " (indispon√≠vel)"
                : h;
            if (ocupados.includes(h)) opt.disabled = true;
            select.appendChild(opt);
        });
    });
});

/* --- Calcula valor automaticamente (crian√ßas x 50) --- */
document.getElementById("numero_criancas").addEventListener("input", function () {
    const qtd = parseInt(this.value) || 0;
    const valor = qtd * 50;
    document.getElementById("valor_total").value = 
        "R$ " + valor.toFixed(2).replace(".", ",");
});
</script>

</body>
</html>


<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reserva Papai Noel</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>
<body>

<!-- MOLDURA -->
<div class="background-frame"></div>

<!-- FORMULÁRIO -->
<div class="form-wrapper">
    <div class="scroll-area">

        {% if mensagem %}
        <div class="msg">{{ mensagem }}</div>
        {% endif %}

        <form action="/agendar" method="POST">

            <label class="label">Data</label>
            <select name="data" id="data" class="input" required>
                <option value="">Selecione...</option>
                <option value="2025-12-24">24 de Dezembro</option>
                <option value="2025-12-25">25 de Dezembro</option>
            </select>

            <label class="label">Horário</label>
            <select name="horario" id="horario" class="input" required>
                <option value="">Selecione uma data...</option>
            </select>

            <label class="label">Nome da criança / responsável</label>
            <input type="text" name="nome" class="input" required />

            <label class="label">Idade</label>
            <input type="text" name="idade" class="input" required />

            <label class="label">E-mail</label>
            <input type="email" name="email" class="input" required />

            <label class="label">Telefone</label>
            <input type="text" name="telefone" class="input" />

            <label class="label">Presente</label>
            <input type="text" name="presente" class="input" />

            <label class="label">Valor Total</label>
            <input type="text" id="valorTotal" name="valor" class="input" readonly required />

            <label class="label">Endereço</label>
            <input type="text" name="endereco" class="input" required />

            <button type="submit">Confirmar Reserva</button>
        </form>

    </div>
</div>

<!-- SCRIPT: CARREGAR HORÁRIOS -->
<script>
document.getElementById("data").addEventListener("change", function () {
    const data = this.value;
    const select = document.getElementById("horario");

    select.innerHTML = "<option>Carregando horários...</option>";

    fetch("/horarios_indisponiveis", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: "data=" + encodeURIComponent(data)
    })
    .then(r => r.json())
    .then(json => {
        const ocupados = json.ocupados || [];
        const horarios = json.horarios_disponiveis || [];

        select.innerHTML = "";

        horarios.forEach(h => {
            const opt = document.createElement("option");
            opt.value = h;
            opt.textContent = ocupados.includes(h)
                ? h + " (indisponível)"
                : h;

            if (ocupados.includes(h)) opt.disabled = true;

            select.appendChild(opt);
        });
    })
    .catch(() => {
        select.innerHTML = "<option>Erro ao carregar horários</option>";
    });
});
</script>

<!-- SCRIPT: CALCULAR VALOR -->
<script>
document.getElementById("numCriancas")?.addEventListener("input", function () {
    const quantidade = parseInt(this.value, 10) || 0;
    const total = quantidade * 50;
    document.getElementById("valorTotal").value =
        "R$ " + total.toFixed(2).replace(".", ",");
});
</script>

</body>
</html>



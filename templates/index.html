<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reserva Papai Noel</title>
    <style>
        body { font-family: Arial; max-width: 600px; margin: 20px auto; }
        label { font-weight: bold; margin-top: 10px; display: block; }
        input, select, textarea {
            width: 100%; padding: 8px; margin-top: 5px; box-sizing: border-box;
        }
        button {
            width: 100%; padding: 10px; background: red; color: white;
            border: none; margin-top: 15px; font-size: 18px; cursor: pointer;
        }
        button:hover { background: darkred; }
        .msg { background: #d4ffd4; padding: 10px; margin: 10px 0; border-left: 5px solid green; }
        option[disabled] { background: #ffcccc; color: #555; }
    </style>
</head>
<body>

    <h2>Formulário de Reservas - Papai Noel</h2>

    {% if mensagem %}
        <div class="msg">{{ mensagem }}</div>
    {% endif %}

    <form action="/enviar" method="POST">

        <label>Data</label>
        <input type="date" name="data" id="data" required min="2024-12-24" max="2024-12-25">

        <label>Horário</label>
        <select name="horario" id="horario" required>
            <option value="">Selecione a data primeiro...</option>
        </select>

        <label>Responsável</label>
        <input type="text" name="responsavel" required>

        <label>Nº de crianças</label>
        <input type="number" name="numero_criancas" required>

        <label>E-mail</label>
        <input type="email" name="email" required>

        <label>Telefone</label>
        <input type="text" name="telefone">

        <label>Valor Total</label>
        <input type="text" name="valor_total">

        <label>Status do Pagamento</label>
        <select name="status_pagamento">
            <option value="Pendente">Pendente</option>
            <option value="Pago">Pago</option>
        </select>

        <label>Observações</label>
        <textarea name="observacoes"></textarea>

        <label>Endereço</label>
        <input type="text" name="endereco">

        <label>Bairro</label>
        <input type="text" name="bairro">

        <label>Cidade</label>
        <input type="text" name="cidade">

        <button type="submit">Enviar Reserva</button>
    </form>

<script>
    document.getElementById("data").addEventListener("change", function() {
        const data = this.value;
        const select = document.getElementById("horario");
        select.innerHTML = "<option>Carregando horários...</option>";

        fetch("/horarios_indisponiveis", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: "data=" + data
        })
        .then(res => res.json())
        .then(json => {
            const ocupados = json.ocupados;
            const horarios = json.horarios_disponiveis;

            select.innerHTML = "";

            horarios.forEach(h => {
                const opt = document.createElement("option");
                opt.value = h;

                if (ocupados.includes(h)) {
                    opt.disabled = true;
                    opt.textContent = h + " (indisponível)";
                } else {
                    opt.textContent = h;
                }
                select.appendChild(opt);
            });
        });
    });
</script>

</body>
</html>

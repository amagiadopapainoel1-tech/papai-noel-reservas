<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reserva Papai Noel</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        /* Botões de seleção de data */
        .date-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .date-btn {
            padding: 12px 22px;
            background: #d50000;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 20px;
            cursor: pointer;
        }

        .date-btn.active {
            background: #8b0000;
            transform: scale(1.05);
        }
    </style>
</head>

<body>
    <div class="phone-frame">
        <div class="form-wrapper">
            <div class="form-container">

                {% if mensagem %}
                <div class="msg">{{ mensagem }}</div>
                {% endif %}

                <form action="/enviar" method="POST">

                    <!-- Seleção por botões -->
                    <label class="label">Data</label>

                    <div class="date-selector">
                        <button type="button" class="date-btn" data-date="2024-12-24">24/12</button>
                        <button type="button" class="date-btn" data-date="2024-12-25">25/12</button>
                    </div>

                    <!-- Campo oculto para receber o valor da data -->
                    <input type="hidden" name="data" id="data" required>

                    <!-- Horário -->
                    <label class="label">Horário</label>
                    <select name="horario" id="horario" class="input" required>
                        <option value="">Selecione a data...</option>
                    </select>

                    <label class="label">Responsável</label>
                    <input type="text" name="responsavel" class="input" required>

                    <label class="label">Nº de crianças</label>
                    <input type="number" name="numero_criancas" class="input" required>

                    <label class="label">E-mail</label>
                    <input type="email" name="email" class="input" required>

                    <label class="label">Telefone</label>
                    <input type="text" name="telefone" class="input">

                    <label class="label">Valor Total</label>
                    <input type="text" name="valor_total" class="input">

                    <label class="label">Status do Pagamento</label>
                    <select name="status_pagamento" class="input">
                        <option value="Pendente">Pendente</option>
                        <option value="Pago">Pago</option>
                    </select>

                    <label class="label">Observações</label>
                    <textarea name="observacoes" class="input"></textarea>

                    <label class="label">Endereço</label>
                    <input type="text" name="endereco" class="input">

                    <label class="label">Bairro</label>
                    <input type="text" name="bairro" class="input">

                    <label class="label">Cidade</label>
                    <input type="text" name="cidade" class="input">

                    <button type="submit">Enviar Reserva</button>
                </form>
            </div>
        </div>
    </div>

<script>
    // Seleção visual dos botões
    const dateButtons = document.querySelectorAll(".date-btn");
    const hiddenDateField = document.getElementById("data");

    dateButtons.forEach(btn => {
        btn.addEventListener("click", () => {
            // Marca botão ativo
            dateButtons.forEach(b => b.classList.remove("active"));
            btn.classList.add("active");

            // Preenche input oculto
            hiddenDateField.value = btn.dataset.date;

            // Dispara carregamento de horários
            loadHorarios(btn.dataset.date);
        });
    });

    // Carregar horários ao selecionar a data
    function loadHorarios(dataSelecionada) {
        const select = document.getElementById("horario");
        select.innerHTML = "<option>Carregando horários...</option>";

        fetch("/horarios_indisponiveis", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: "data=" + dataSelecionada
        })
        .then(res => res.json())
        .then(json => {
            const ocupados = json.ocupados;
            const horarios = json.horarios_disponiveis;

            select.innerHTML = "";

            horarios.forEach(h => {
                const opt = document.createElement("option");
                opt.value = h;
                opt.textContent = ocupados.includes(h)
                    ? h + " (indisponível)"
                    : h;

                if (ocupados.includes(h))
                    opt.disabled = true;

                select.appendChild(opt);
            });
        });
    }
</script>

</body>
</html>
